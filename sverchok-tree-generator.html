<!doctype html>
<html lang="">	
<head>
	<meta charset="utf-8"/>
	<title>Sverchok Tree Generator - Look Think Make</title>	
	<meta name="author" content="elfnor">
	

	<meta name="description" content="I tend toward making more abstract than realistic images with Blender. A while back I played with the Ivy Generator addon and so got interested in the underlying procedural algorithms for producing tree and plant structures. A lot of these techiques use L-systems and could maybe be implemented using the ...">


	<link rel="top" href="#" /><link href='http://fonts.googleapis.com/css?family=Source+Sans+Pro:300,400,600,300italic,400italic,600italic|Source+Code+Pro' rel='stylesheet' type='text/css'></link>
	<link href='http://fonts.googleapis.com/css?family=Bitter' rel='stylesheet' type='text/css'>
<link href='http://fonts.googleapis.com/css?family=Rock+Salt' rel='stylesheet' type='text/css'>
	<link rel="stylesheet" href="http://www.elfnor.com/theme/css/main.css" type="text/css" />
		

    <link href="http://www.elfnor.com/feeds/all.atom.xml" type="application/atom+xml" rel="alternate" title="Look Think Make Atom Feed" />
</head>
	
<body>

    <div class="container">
	  
	  <header role="banner">
	    <div class="feeds">
	        <a href="http://www.elfnor.com/feeds/all.atom.xml" rel="alternate"><img src="/theme/images/icons/feed-32px.png" alt="atom feed"/></a>
	    </div>
	      <nav class="pages">
			  <a href="http://www.elfnor.com/pages/about-me.html">About Me</a>
-			  <a href="http://www.elfnor.com/pages/galleries.html">Galleries</a>
	      </nav>
		<a href="http://www.elfnor.com" class="title">Look Think Make</a>
      </header>
	
	  <div class="wrapper">

		  <div role="main" class="content">
	<article class="full">
			
		<h1>Sverchok Tree Generator</h1>
		
<div class="metadata">
  <time datetime="2016-08-12T22:00:00+12:00" pubdate>Fri 12 August 2016</time>
    <address class="vcard author">
      by <a class="url fn" href="http://www.elfnor.com/author/elfnor.html">elfnor</a>
    </address>
  in <a href="http://www.elfnor.com/category/think.html">think</a>
<p class="tags">tagged <a href="http://www.elfnor.com/tag/make.html">make</a>, <a href="http://www.elfnor.com/tag/think.html">think</a>, <a href="http://www.elfnor.com/tag/blender.html">blender</a>, <a href="http://www.elfnor.com/tag/sverchok.html">sverchok</a>, <a href="http://www.elfnor.com/tag/generative-art.html">generative art</a></p></div>		
		<p><img alt="tree" src="./images/sca-render_005.png" /></p>
<p>I tend toward making more abstract than realistic images with Blender.  A <a href="http://www.elfnor.com/blender-ivy-gen-abstracts.html">while back</a> I played with the <em>Ivy Generator</em> addon and so got interested in the underlying procedural algorithms for producing tree and plant structures.  A lot of these techiques use L-systems and could maybe be implemented using the Sverchok <a href="http://www.elfnor.com/generative-art-sverchok-node-update.html">Generative Art</a> node. Except the <em>Genertive Art</em> node has no provision (yet) for collision avoidance. This results in intersecting branches which is not always what I want.</p>
<p>Somewhere in my research into procedural plants I came across the Space Colonization Algorithm which is a different approach to tree generation and decided to write this algoithm up as a Sverchok scripted node.</p>
<p>The Space Colonization Algorithim (SC Algorithm) was originally described in <a href="http://www.academia.edu/download/46349919/colonization.egwnp2007.pdf">this paper</a> by Adam Runions, Brendan Lane and Przemyslaw Prusinkiewicz. </p>
<p>There are good short descriptions of how the algorithm works on <a href="http://www.jgallant.com/procedurally-generating-trees-with-space-colonization-algorithm-in-xna/">jgallant's blog</a> or on <a href="Jose's Sketchbook">Jose's Sketchbook</a>.</p>
<blockquote>
<p>The idea for the <strong>Space Colonization Algorithm</strong> is brilliantly simple: instead of generating the nodes that build our structure by using a set of rules (e.g. a grammar), we begin by producing a set of <strong>attractor points</strong> by sampling a domain -the surface of an object in our case-. Then we provide one or several <strong>start locations</strong>, and we iteratively start adding nodes by looking for the set of <strong>nearest <em>active</em> attractors</strong>, and growing towards them. When a new node is added, it <strong>kills all the attractor points</strong> which fall within a specified range, preventing other branches to fill in the same space, and directing the growth forward.</p>
</blockquote>
<p>Varkenvarken's Space Tree(<a href="https://github.com/varkenvarken/spacetree">free github version</a>, <a href="https://cgcookiemarkets.com/all-products/space-tree-pro/">Space Tree Pro</a>) addon for Blender uses the SC Algorithm to produce really versatile and realistic trees. My version is extremely simple but the ability to directly control the cloud of attractor points works well for my abstract doodles.</p>
<p>Here's a simple GIF showing the algorithm in action. The red points are the <em>End Vertices</em> or attractor points. There is one start point at (0, 0, 0).</p>
<p><img alt="gif of sca" src="./images/sca_gif.gif" /></p>
<p><img alt="node diagram for gif" src="./images/sca_gif_nodes.png" /></p>
<p>I started off looking at varkenvarken's github code but ended up completly rewriting it to use numpy. I then spent far longer than was reasonable optimizing my code to get a real-time response to parameter changes. The heart of the algorithm involves a large number of <a href="https://en.wikipedia.org/wiki/Nearest_neighbor_search">nearest neighbor searches</a>. This is a classic problem with many solutions (kdtrees, octrees, locality sensitive hashing). I looked at some of these but the fastest solution I could code (before I got bored) was to naively calculate every distance using numpy outer product. The whole SC Algorithm would make a great class (or competition) challenge in code speed optimization as there seems to be so many complicated ways to make it slower.</p>
<p>Install the <a href="http://nikitron.cc.ua/sverchok_en.html">Sverchok</a> addon into <a href="https://www.blender.org/">Blender</a>. Download the Tree Generator code from <a href="https://github.com/elfnor/spacetree-sverchok">github</a>. Then load the python file <em>tree_generator.py</em> as a text blocks into a blend file. Add a <em>Scripted Node</em> to a Sverchok node tree. On the node select the <em>tree_generator.py</em> code from the lower drop down. Then click the plugin icon to the right of this field. The node should turn blue with some inputs and outputs.</p>
<p>The node inputs:  </p>
<ul>
<li><strong>maximum branches</strong>: the number of iterations of the algorithm. The number of tree vertices will actually be greater than this  </li>
<li><strong>branch length</strong>: distance beween tree vertices  </li>
<li><strong>minimum distance</strong>:  when a new tree vertex is added, all the attractor points within this radius are "killed"  </li>
<li><strong>maximum distance</strong>:  attractor points greater than this distance are ignored  </li>
<li><strong>tip radius</strong>:  used to calculate branch radii, the radius of the tip at the end of the branches  </li>
<li><strong>tropism</strong>:  vector that is added to each new branch segment, can be used to make branches droop under gravity. Length of vector needs to be smaller than branch length.  </li>
<li><strong>End Vertices</strong>:  set of attractor points that the tree will grow toward  </li>
<li><strong>Start Vertices</strong>:  start locations for tree to grow from  </li>
</ul>
<p>The node outputs:  </p>
<ul>
<li><strong>Vertices</strong>:  vertices (nodes) in tree structure  </li>
<li><strong>Edges</strong>:  edges conectiong vertices in tree structure  </li>
<li><strong>Branch radii</strong>:  radius of tree at each vertex.  This is calculated using a "pipe model". That is at a vertex where two branches join,  the area of the cross section is the sum of the areas of the two branches.  </li>
<li><strong>Ends mask</strong>:  a boolean list that is true for vertices that are at the end of a branch. Can be used with a <em>List Mask</em> node.  </li>
<li><strong>Leaf matrices</strong>:  a list of transform matrices that can be used to place an object at the end of each branch. The x-direction of the object will be aligned with the last segment in the branch.  </li>
</ul>
<p>Here is the Sverchok node diagram to produce the tree in the top image. A spherical cloud of atractor points is produced using the random vector and scalar nodes on the left.  The <em>Skin Mesher</em> node is used to give thickness to the trunk and branches. The leaves are produced by the <em>Mesh Instancer</em> node. This make copies of a fairly simple leaf object (see insert) that has a image texture with an alpha channel. The textures are from EugeneKiver on <a href="http://www.blendswap.com/blends/view/59269">blendswap</a>. The modifiers on the tree trunk need to be applied before the UV texturing will work.</p>
<p><img alt="sca tree nodes" src="./images/sca_tree_nodes.png" /></p>
<p>Here is another example (not so tree like) of what is possible with the Tree Generator.</p>
<p><img alt="torus" src="./images/sca_test3b_004.png" /></p>
<p>I like to code my Blender procedural experiments (<a href="http://www.elfnor.com/maze-any-mesh-in-blender.html">maze any mesh</a>, <a href="http://www.elfnor.com/blender-2d-maze-generator.html">2D mazes</a>, <a href="http://www.elfnor.com/blender-3d-maze-generator.html">3D mazes</a>, <a href="http://www.elfnor.com/hyperbolic-tiling-in-3d.html">hyperbolic plane tilings</a>, <a href="http://www.elfnor.com/blender-adventures-with-hyperbolic-planes.html">more hyperbolic planes</a>, <a href="http://www.elfnor.com/sverchok-tree-generator.html">bloom spheres</a> ) as Sverchok nodes as I can concentrate on getting my code to produce simple lists (of vertices, edges, faces, and matrices) and Sverchok takes care of produing the actual mesh in Blender. The inputs and parameters provide a simple interface for the code without messing with the Blender API.</p>
<hr />	

	</article>

	<div class="comments">
	<h2>Comments !</h2>
	    <div id="disqus_thread"></div>
	    <script type="text/javascript">
	       var disqus_identifier = "sverchok-tree-generator.html";
	       (function() {
	       var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
	       dsq.src = 'http://lookthinkmake.disqus.com/embed.js';
	       (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
	      })();
	    </script>
	</div>

		  </div>	
		  
		  <div class="sidebar">

	        <nav>
		  <h2>Recent Posts</h2>
			<ul class="archive">
	
			      <li>
<a href="http://www.elfnor.com/preserved-lemons.html" rel="bookmark" title="Permalink to Preserved Lemons">Preserved Lemons</a>
  <time datetime="2017-01-13T22:00:00+13:00" pubdate>Fri 13 January 2017</time>
<p class="tags">tags: <a href="http://www.elfnor.com/tag/make.html">make  </a><a href="http://www.elfnor.com/tag/food.html">food  </a></p></a>      			      </li>
		
	
			      <li>
<a href="http://www.elfnor.com/fermented-chili-and-garlic-sauce.html" rel="bookmark" title="Permalink to Fermented Chili and Garlic sauce">Fermented Chili and Garlic sauce</a>
  <time datetime="2017-01-06T22:00:00+13:00" pubdate>Fri 06 January 2017</time>
<p class="tags">tags: <a href="http://www.elfnor.com/tag/make.html">make  </a><a href="http://www.elfnor.com/tag/food.html">food  </a></p></a>      			      </li>
		
	
			      <li>
<a href="http://www.elfnor.com/pyboard-datalogger.html" rel="bookmark" title="Permalink to PyBoard Datalogger">PyBoard Datalogger</a>
  <time datetime="2016-10-21T22:00:00+13:00" pubdate>Fri 21 October 2016</time>
<p class="tags">tags: <a href="http://www.elfnor.com/tag/make.html">make  </a><a href="http://www.elfnor.com/tag/python.html">python  </a><a href="http://www.elfnor.com/tag/micropython.html">micropython  </a><a href="http://www.elfnor.com/tag/3d-printing.html">3D Printing  </a></p></a>      			      </li>
		
	
			      <li>
<a href="http://www.elfnor.com/sverchok-tree-generator.html" rel="bookmark" title="Permalink to Sverchok Tree Generator">Sverchok Tree Generator</a>
  <time datetime="2016-08-12T22:00:00+12:00" pubdate>Fri 12 August 2016</time>
<p class="tags">tags: <a href="http://www.elfnor.com/tag/make.html">make  </a><a href="http://www.elfnor.com/tag/think.html">think  </a><a href="http://www.elfnor.com/tag/blender.html">blender  </a><a href="http://www.elfnor.com/tag/sverchok.html">sverchok  </a><a href="http://www.elfnor.com/tag/generative-art.html">generative art  </a></p></a>      			      </li>
		
	
			      <li>
<a href="http://www.elfnor.com/penrose-tile-painting-in-blender.html" rel="bookmark" title="Permalink to Penrose Tile Painting in Blender">Penrose Tile Painting in Blender</a>
  <time datetime="2016-06-04T22:00:00+12:00" pubdate>Sat 04 June 2016</time>
<p class="tags">tags: <a href="http://www.elfnor.com/tag/make.html">make  </a><a href="http://www.elfnor.com/tag/think.html">think  </a><a href="http://www.elfnor.com/tag/blender.html">blender  </a><a href="http://www.elfnor.com/tag/symmetrytile.html">symmetrytile  </a></p></a>      			      </li>
		
	
			      <li>
<a href="http://www.elfnor.com/structure-synth-eisenscript-to-xml-translator.html" rel="bookmark" title="Permalink to Structure Synth eisenscript to xml translator">Structure Synth eisenscript to xml translator</a>
  <time datetime="2016-05-29T22:00:00+12:00" pubdate>Sun 29 May 2016</time>
<p class="tags">tags: <a href="http://www.elfnor.com/tag/make.html">make  </a><a href="http://www.elfnor.com/tag/think.html">think  </a><a href="http://www.elfnor.com/tag/blender.html">blender  </a><a href="http://www.elfnor.com/tag/sverchok.html">sverchok  </a><a href="http://www.elfnor.com/tag/structure-synth.html">structure synth  </a><a href="http://www.elfnor.com/tag/generative-art.html">generative art  </a></p></a>      			      </li>
		
	
			      <li>
<a href="http://www.elfnor.com/first-milky-way-photo.html" rel="bookmark" title="Permalink to First Milky Way photo">First Milky Way photo</a>
  <time datetime="2016-05-25T22:00:00+12:00" pubdate>Wed 25 May 2016</time>
<p class="tags">tags: <a href="http://www.elfnor.com/tag/photo.html">photo  </a><a href="http://www.elfnor.com/tag/astro.html">astro  </a></p></a>      			      </li>
		
		
		
		
		
		
		
		
		
		
		
		
		
		
		
		
		
		
		
		
		
		
		
		
		
		
		
		
		
		
		
		
		
		
		
		
		
		
		
		
		
		
		
		
		
		
		
		
		
		
		
		
		
		
		
		
		
		
	
                        </u1>
		
		</nav>

	          <h2>Categories</h2>
	          <ul class = "social">
		      <li> <a href="http://www.elfnor.com/archives.html">everything </a></li>	
	              <li ><a href="http://www.elfnor.com/category/food.html">food</a></li>
	              <li ><a href="http://www.elfnor.com/category/look.html">look</a></li>
	              <li ><a href="http://www.elfnor.com/category/make.html">make</a></li>
	              <li class="active"><a href="http://www.elfnor.com/category/think.html">think</a></li>
	          </ul>
	        

	          <aside>
	          <h2>Elsewhere</h2>
			    <ul class="social">
				  <li><a href="http://elfnor.deviantart.com">on deviant art</a><i></i></li>
				  <li><a href="http://www.thingiverse.com/elfnor">on thingiverse</a><i></i></li>
				  <li><a href="https://github.com/elfnor">on github</a><i></i></li>
			    </ul>
			  </aside>
                
                <h2>Tags</h2>
	
                        <ul class="tagcloud">
                            <li class="tag-3"><a href="http://www.elfnor.com/tag/generative-art.html">generative art</a></li>
                            <li class="tag-2"><a href="http://www.elfnor.com/tag/symmetrytile.html">symmetrytile</a></li>
                            <li class="tag-3"><a href="http://www.elfnor.com/tag/python.html">python</a></li>
                            <li class="tag-3"><a href="http://www.elfnor.com/tag/materials.html">materials</a></li>
                            <li class="tag-4"><a href="http://www.elfnor.com/tag/photo.html">photo</a></li>
                            <li class="tag-3"><a href="http://www.elfnor.com/tag/food.html">food</a></li>
                            <li class="tag-2"><a href="http://www.elfnor.com/tag/reading.html">reading</a></li>
                            <li class="tag-3"><a href="http://www.elfnor.com/tag/pelican.html">pelican</a></li>
                            <li class="tag-3"><a href="http://www.elfnor.com/tag/geocaching.html">geocaching</a></li>
                            <li class="tag-1"><a href="http://www.elfnor.com/tag/sverchok.html">sverchok</a></li>
                            <li class="tag-3"><a href="http://www.elfnor.com/tag/maze.html">maze</a></li>
                            <li class="tag-1"><a href="http://www.elfnor.com/tag/think.html">think</a></li>
                            <li class="tag-4"><a href="http://www.elfnor.com/tag/nonsense.html">nonsense</a></li>
                            <li class="tag-3"><a href="http://www.elfnor.com/tag/3d-printing.html">3D Printing</a></li>
                            <li class="tag-4"><a href="http://www.elfnor.com/tag/astro.html">astro</a></li>
                            <li class="tag-4"><a href="http://www.elfnor.com/tag/webalbum.html">webalbum</a></li>
                            <li class="tag-3"><a href="http://www.elfnor.com/tag/copy2.html">copy2</a></li>
                            <li class="tag-1"><a href="http://www.elfnor.com/tag/blender.html">blender</a></li>
                            <li class="tag-2"><a href="http://www.elfnor.com/tag/structuresynth.html">structuresynth</a></li>
                            <li class="tag-3"><a href="http://www.elfnor.com/tag/cats.html">cats</a></li>
                            <li class="tag-3"><a href="http://www.elfnor.com/tag/markdown.html">markdown</a></li>
                            <li class="tag-4"><a href="http://www.elfnor.com/tag/structure-synth.html">structure synth</a></li>
                            <li class="tag-4"><a href="http://www.elfnor.com/tag/processing.html">processing</a></li>
                            <li class="tag-3"><a href="http://www.elfnor.com/tag/micropython.html">micropython</a></li>
                            <li class="tag-1"><a href="http://www.elfnor.com/tag/make.html">make</a></li>
                            <li class="tag-4"><a href="http://www.elfnor.com/tag/kites.html">kites</a></li>
                            <li class="tag-3"><a href="http://www.elfnor.com/tag/ebook.html">ebook</a></li>
                        </ul>
                      
		
		  </div>

	  </div>

      <footer>
		<p role="contentinfo">
		  © 2013 elfnor - Proudly powered by <a href="http://alexis.notmyidea.org/pelican/">pelican</a>. Theme <a href="https://github.com/fle/pelican-simplegrey"> pelican-simplegrey</a>, modified.
    	</p>

	  </footer>	

	</div>
<!-- Start of StatCounter Code for Default Guide -->
<script type="text/javascript">
var sc_project=9900594; 
var sc_invisible=1; 
var sc_security="efb2c43c"; 
var scJsHost = (("https:" == document.location.protocol) ?
"https://secure." : "http://www.");
document.write("<sc"+"ript type='text/javascript' src='" +
scJsHost+
"statcounter.com/counter/counter.js'></"+"script>");
</script>
<noscript><div class="statcounter"><a title="free hit
counter" href="http://statcounter.com/" target="_blank"><img
class="statcounter"
src="http://c.statcounter.com/9900594/0/efb2c43c/1/"
alt="free hit counter"></a></div></noscript>
<!-- End of StatCounter Code for Default Guide -->
</body>
</html>