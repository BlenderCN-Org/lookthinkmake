<!doctype html>
<html lang="">	
<head>
	<meta charset="utf-8"/>
	<title>Blender Game Level Generator - Look Think Make</title>	
	<meta name="author" content="elfnor">
	

	<meta name="description" content="I was testing a puzzle level for my partner Tech Monkey's Steely Taws Blender game and the components started to look a bit like things produced by my Blender Pipe Generator. Steely Taws - No Quitsies is a marble run game based on Switchball and Balance. At its most basic ...">


	<link rel="top" href="#" /><link href='http://fonts.googleapis.com/css?family=Source+Sans+Pro:300,400,600,300italic,400italic,600italic|Source+Code+Pro' rel='stylesheet' type='text/css'></link>
	<link href='http://fonts.googleapis.com/css?family=Bitter' rel='stylesheet' type='text/css'>
<link href='http://fonts.googleapis.com/css?family=Rock+Salt' rel='stylesheet' type='text/css'>
	<link rel="stylesheet" href="http://www.elfnor.com/theme/css/main.css" type="text/css" />
		

    <link href="http://www.elfnor.com/feeds/all.atom.xml" type="application/atom+xml" rel="alternate" title="Look Think Make Atom Feed" />
</head>
	
<body>

    <div class="container">
	  
	  <header role="banner">
	    <div class="feeds">
	        <a href="http://www.elfnor.com/feeds/all.atom.xml" rel="alternate"><img src="/theme/images/icons/feed-32px.png" alt="atom feed"/></a>
	    </div>
	      <nav class="pages">
			  <a href="http://www.elfnor.com/pages/about-me.html">About Me</a>
-			  <a href="http://www.elfnor.com/pages/galleries.html">Galleries</a>
	      </nav>
		<a href="http://www.elfnor.com" class="title">Look Think Make</a>
      </header>
	
	  <div class="wrapper">

		  <div role="main" class="content">
	<article class="full">
			
		<h1>Blender Game Level Generator</h1>
		
<div class="metadata">
  <time datetime="2015-06-11T22:00:00+12:00" pubdate>Thu 11 June 2015</time>
    <address class="vcard author">
      by <a class="url fn" href="http://www.elfnor.com/author/elfnor.html">elfnor</a>
    </address>
  in <a href="http://www.elfnor.com/category/think.html">think</a>
<p class="tags">tagged <a href="http://www.elfnor.com/tag/make.html">make</a>, <a href="http://www.elfnor.com/tag/think.html">think</a>, <a href="http://www.elfnor.com/tag/blender.html">blender</a>, <a href="http://www.elfnor.com/tag/sverchok.html">sverchok</a>, <a href="http://www.elfnor.com/tag/structuresynth.html">structuresynth</a></p></div>		
		<p><img alt="game wide shot" src="/images/level_gen_STD_ramps_render_017.png" /></p>
<p>I was testing a puzzle level for my partner Tech Monkey's <a href="http://www.techmonkeybusiness.com/steely-taws-puzzle-game-v1.html"><strong>Steely Taws</strong> Blender game</a> and the components started to look a bit like things produced by my <a href="http://www.elfnor.com/blender-pipe-generator.html">Blender Pipe Generator</a>. </p>
<p><strong>Steely Taws - No Quitsies</strong> is a marble run game based on Switchball and Balance. At its most basic it requires straights, bends and ramps. It was not too hard to put together an automatic level generator using the "Generative Art" node of the <a href="https://github.com/nortikin/sverchok">Sverchok</a> Blender add-on. If you're new to Sverchok maybe back up and read my Simple Sverchok series (<a href="http://www.elfnor.com/simple-sverchok-01-centers-polygons.html">part 1</a>) and the <a href="https://github.com/nortikin/sverchok/blob/master/docs/nodes/generator/generative_art.rst">documentation for the node</a>.</p>
<p>I'll start with a simple example that just has very basic components, then I'll show you how we standardized the Steely Taws game components to work with the "Generative Art" node. Then I'll finish up with the blend file with the components, Sverchok node diagram, xml description to build the level and the game logic to allow anyone to generate and play an unlimited number of random Steely Taws game levels. The same concept could be used to produce random levels for games with quite different architectures, for example a dungeon game with corridors and stairs.</p>
<p>For a demo version to prove this would work I made a simple straight, bend and ramp. The straight section needs to go from (-0.5, 0, 0) to (0.5, 0, 0). The bend goes from (1, 0, 0) to (0, 1, 0) and has its origin at (0, 0, 0). This is the same as the <a href="http://www.elfnor.com/blender-pipe-generator.html">Blender Pipe Generator</a> but in this case the components are flat rather than round. The ramp goes up from (-0.5, 0.5, 0) to (0.5, 0.5, 0).</p>
<p><img alt="simple game components" src="/images/simple_components.png" /></p>
<p>The xml that describes the design is very similar to that used for the Pipe Generator. It defines 6 versions of the "R1" rule. The Generative Art node chooses versions of these rules at random. The first version places the straight section, the next two place left and right bends rotating the bend object as required. The next two place the ramp object to go up or down and the last version creates an intersection. The names for the shapes have been prefixed with "00", "01", "02" so they  sort in a predictable way to make it easy to assign the correct object to the correct shape in the Sverchok node diagram. </p>
<div class="highlight"><pre><span class="nt">&lt;rules</span> <span class="na">max_depth=</span><span class="s">&quot;50&quot;</span><span class="nt">&gt;</span>
    <span class="nt">&lt;rule</span> <span class="na">name=</span><span class="s">&quot;entry&quot;</span><span class="nt">&gt;</span>
        <span class="nt">&lt;call</span> <span class="na">count=</span><span class="s">&quot;4&quot;</span> <span class="na">transforms=</span><span class="s">&quot;rz 90&quot;</span> <span class="na">rule=</span><span class="s">&quot;R1&quot;</span><span class="nt">/&gt;</span>
    <span class="nt">&lt;/rule&gt;</span>
    <span class="nt">&lt;rule</span> <span class="na">name=</span><span class="s">&quot;R1&quot;</span> <span class="na">weight=</span><span class="s">&quot;100&quot;</span> <span class="na">dir=</span><span class="s">&quot;straight&quot;</span><span class="nt">&gt;</span>
        <span class="nt">&lt;instance</span> <span class="na">transforms=</span><span class="s">&quot;tx 0.5&quot;</span> <span class="na">shape=</span><span class="s">&quot;00_straight&quot;</span><span class="nt">/&gt;</span>
        <span class="nt">&lt;call</span> <span class="na">transforms=</span><span class="s">&quot;tx 0.5&quot;</span> <span class="na">rule=</span><span class="s">&quot;R1&quot;</span><span class="nt">/&gt;</span>
    <span class="nt">&lt;/rule&gt;</span>

    <span class="nt">&lt;rule</span> <span class="na">name=</span><span class="s">&quot;R1&quot;</span> <span class="na">weight=</span><span class="s">&quot;10&quot;</span> <span class="na">dir=</span><span class="s">&quot;left&quot;</span><span class="nt">&gt;</span>
        <span class="nt">&lt;instance</span> <span class="na">transforms=</span><span class="s">&quot;ty -1&quot;</span> <span class="na">shape=</span><span class="s">&quot;01_bend&quot;</span><span class="nt">/&gt;</span>
        <span class="nt">&lt;call</span> <span class="na">transforms=</span><span class="s">&quot;tx 1 rz -90&quot;</span> <span class="na">rule=</span><span class="s">&quot;R1&quot;</span><span class="nt">/&gt;</span>
    <span class="nt">&lt;/rule&gt;</span>

    <span class="nt">&lt;rule</span> <span class="na">name=</span><span class="s">&quot;R1&quot;</span> <span class="na">weight=</span><span class="s">&quot;10&quot;</span> <span class="na">dir=</span><span class="s">&quot;right&quot;</span><span class="nt">&gt;</span>
        <span class="nt">&lt;instance</span> <span class="na">transforms=</span><span class="s">&quot;rz -90 tx -1&quot;</span> <span class="na">shape=</span><span class="s">&quot;01_bend&quot;</span><span class="nt">/&gt;</span>
        <span class="nt">&lt;call</span> <span class="na">transforms=</span><span class="s">&quot;ty 1 rz 180&quot;</span> <span class="na">rule=</span><span class="s">&quot;R1&quot;</span><span class="nt">/&gt;</span>
    <span class="nt">&lt;/rule&gt;</span>

    <span class="nt">&lt;rule</span> <span class="na">name=</span><span class="s">&quot;R1&quot;</span> <span class="na">weight=</span><span class="s">&quot;10&quot;</span> <span class="na">dir=</span><span class="s">&quot;up&quot;</span><span class="nt">&gt;</span>
        <span class="nt">&lt;instance</span> <span class="na">transforms=</span><span class="s">&quot;tx 0.5 tz 0.5&quot;</span> <span class="na">shape=</span><span class="s">&quot;02_ramp&quot;</span><span class="nt">/&gt;</span>
        <span class="nt">&lt;call</span> <span class="na">transforms=</span><span class="s">&quot;tx 0.5 tz 0.5&quot;</span> <span class="na">rule=</span><span class="s">&quot;R1&quot;</span><span class="nt">/&gt;</span>
    <span class="nt">&lt;/rule&gt;</span>

    <span class="nt">&lt;rule</span> <span class="na">name=</span><span class="s">&quot;R1&quot;</span> <span class="na">weight=</span><span class="s">&quot;10&quot;</span> <span class="na">dir=</span><span class="s">&quot;down&quot;</span><span class="nt">&gt;</span>
        <span class="nt">&lt;instance</span> <span class="na">transforms=</span><span class="s">&quot;tx 0.5 tz -0.5 rz 180&quot;</span> <span class="na">shape=</span><span class="s">&quot;02_ramp&quot;</span><span class="nt">/&gt;</span>
        <span class="nt">&lt;call</span> <span class="na">transforms=</span><span class="s">&quot;rz 180 tx 0.5 tz -0.5&quot;</span> <span class="na">rule=</span><span class="s">&quot;R1&quot;</span><span class="nt">/&gt;</span>
    <span class="nt">&lt;/rule&gt;</span>

    <span class="nt">&lt;rule</span> <span class="na">name=</span><span class="s">&quot;R1&quot;</span> <span class="na">weight=</span><span class="s">&quot;10&quot;</span> <span class="na">dir=</span><span class="s">&quot;branch&quot;</span><span class="nt">&gt;</span>
        <span class="nt">&lt;call</span> <span class="na">rule=</span><span class="s">&quot;R1&quot;</span><span class="nt">/&gt;</span>
        <span class="nt">&lt;call</span> <span class="na">transforms=</span><span class="s">&quot;rz 90&quot;</span> <span class="na">rule=</span><span class="s">&quot;R1&quot;</span><span class="nt">/&gt;</span>
    <span class="nt">&lt;/rule&gt;</span>

<span class="nt">&lt;/rules&gt;</span>
</pre></div>


<p>The Sverchok node diagram is a bit more complicated than for the Pipe Generator as we now have three different types of objects (straights, bends and ramps) to place. The easiest way to do this is to use a "Logic" node before the "Mask" node.</p>
<p><img alt="node diagram" src="/images/level_gen_demo_nodes.png" /></p>
<p><img alt="simple level" src="/images/level_gen_demo.blend1.png" /></p>
<p>The "Generative Art" node processes the xml file to randomly add the different types of objects. The weights given with each version of the rule determine the frequency of each type of component. Increase the weight of the "left" and "right" version of the rules and the design will have many more bends. Changing the "rseed" value in the "Generative Art" node generates a different set of random numbers and will produce a different level design.</p>
<p>The processor dosen't know anything about where it previously placed objects so there will be random intersections of paths. With simple objects these intersections look the same as branches and just add to the complexity of the design.  With the objects used in the Steely Taws game the rails placed on the sides of the path make these intersections tricky to play. Manual editing is required to tidy these intersections up deleting rails where needed. </p>
<p>Seeing the demo worked well my partner set to work standardizing the Steely Taws components so they fitted on a regular grid. The demo above is based on a grid of 1 Blender unit, the game components have a standard size of 12 units long, x 4.25 units wide, and 3 units deep.</p>
<p><img alt="std components" src="/images/STD_Components-sml.png" /></p>
<p>The drop deck components are interesting as they make some paths one way only. This means the player can get stuck with no way back. Either follow up the auto level generation with some hand editing to make the game level playable or only use ramps (set the weight of the drops to zero). The ramps can be driven both up and down. To keep the level from always dropping or climbing make the sum of the weights of down components (drops and down ramps) equal to the weight of the up ramps.</p>
<p>In the blend file I've used "mesh instancer" nodes to the replace the "Objects In" and "Viewer Draw" nodes. This allows the same mesh to be used for every straight in a similar way to when you do  a linked duplicate in Blender and produces a much smaller file.</p>
<p>Here are some screen shots of the game being played in the Blender Game Engine.</p>
<p><img alt="screen shot 1 of game in play" src="/images/steely_taws_screenshot_1.png" /></p>
<p><img alt="screen shot 2 of game in play" src="/images/steely_taws_screenshot_2.png" /></p>
<p>The blend file available <a href="/downloads/steely_taws_level_gen.blend">here</a> contains each of the components on a separate layer. The game itself should be generated on the 1st layer.</p>
<p>Install a recent version of <a href="https://github.com/nortikin/sverchok">Sverchok</a> then open the blend file. A simple level with 50 components should be automatically generated. Maximise the 3D View (CTRL-UP). Select the  camera view (NUMPAD-0) then press P to start the game. Controls are provided for either the arrow keys or a joystick. If you fall off the edge you will automatically respawn at the start.</p>
<p>To make your own levels, press ESC to close the game and return to Blender. </p>
<p>The easiest way to get a new level is to change the the "rseed" value in the "Generative Art" node. The levels are random and all parts of the level may not be reachable due to intersecting paths. Also some parts of the levels may be dead ends due to the drops being one-way. Edit the level by deleting or moving components. Most of the handrails are separate objects so they be easily deleted at intersections. Delete lots more rails to make a level more difficult.</p>
<p>Another way to change a level is to change the weights for each rule in the xml text block (steely_taws.xml). The larger a weight the more often that component will appear in the level. </p>
<p>Setting the weight of a rule to zero will mean that component will not appear at all. This may require some changes to the numbers in the "Logic" equal nodes to make the correct mask output connect to the correct object. Each integer in the "Mask" output of the "Generative Art" node corresponds to one of the shapes use in the xml. The integers are assigned to the shapes in alphabetical order. So if one shape disappears from the output the ones further down in the order will move down one integer. The "drops" have been given the last places in the shapes list so they can have their weights set to zero without affecting the other shapes. </p>
<p>Go across to Tech Monkey and get the full <a href="http://www.techmonkeybusiness.com/steely-taws-puzzle-game-v1.html">puzzle version</a> to add more puzzle features such as switches, movable boxes,barriers, gates, elevators and draw bridges. The components are all described in detail <a href="http://www.techmonkeybusiness.com/steely-taws-components.html">here</a>.</p>
<hr />	

	</article>

	<div class="comments">
	<h2>Comments !</h2>
	    <div id="disqus_thread"></div>
	    <script type="text/javascript">
	       var disqus_identifier = "blender-game-level-generator.html";
	       (function() {
	       var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
	       dsq.src = 'http://lookthinkmake.disqus.com/embed.js';
	       (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
	      })();
	    </script>
	</div>

		  </div>	
		  
		  <div class="sidebar">

	        <nav>
		  <h2>Recent Posts</h2>
			<ul class="archive">
	
			      <li>
<a href="http://www.elfnor.com/blender-2d-maze-generator.html" rel="bookmark" title="Permalink to Blender 2D Maze Generator">Blender 2D Maze Generator</a>
  <time datetime="2015-12-11T22:00:00+13:00" pubdate>Fri 11 December 2015</time>
<p class="tags">tags: <a href="http://www.elfnor.com/tag/make.html">make  </a><a href="http://www.elfnor.com/tag/think.html">think  </a><a href="http://www.elfnor.com/tag/blender.html">blender  </a><a href="http://www.elfnor.com/tag/sverchok.html">sverchok  </a><a href="http://www.elfnor.com/tag/maze.html">maze  </a></p></a>      			      </li>
		
	
			      <li>
<a href="http://www.elfnor.com/larger-hyperbolic-tilings-in-3d-using-processing.html" rel="bookmark" title="Permalink to Larger Hyperbolic Tilings in 3D using Processing">Larger Hyperbolic Tilings in 3D using Processing</a>
  <time datetime="2015-11-27T22:00:00+13:00" pubdate>Fri 27 November 2015</time>
<p class="tags">tags: <a href="http://www.elfnor.com/tag/make.html">make  </a><a href="http://www.elfnor.com/tag/think.html">think  </a><a href="http://www.elfnor.com/tag/blender.html">blender  </a><a href="http://www.elfnor.com/tag/processing.html">processing  </a></p></a>      			      </li>
		
	
			      <li>
<a href="http://www.elfnor.com/symmetry-tile-painting-in-blender.html" rel="bookmark" title="Permalink to Symmetry Tile Painting in Blender">Symmetry Tile Painting in Blender</a>
  <time datetime="2015-11-21T22:00:00+13:00" pubdate>Sat 21 November 2015</time>
<p class="tags">tags: <a href="http://www.elfnor.com/tag/make.html">make  </a><a href="http://www.elfnor.com/tag/think.html">think  </a><a href="http://www.elfnor.com/tag/blender.html">blender  </a><a href="http://www.elfnor.com/tag/symmetrytile.html">symmetrytile  </a></p></a>      			      </li>
		
	
			      <li>
<a href="http://www.elfnor.com/painting-in-the-hyperbolic-plane.html" rel="bookmark" title="Permalink to Painting in the Hyperbolic Plane">Painting in the Hyperbolic Plane</a>
  <time datetime="2015-11-14T22:00:00+13:00" pubdate>Sat 14 November 2015</time>
<p class="tags">tags: <a href="http://www.elfnor.com/tag/make.html">make  </a><a href="http://www.elfnor.com/tag/think.html">think  </a><a href="http://www.elfnor.com/tag/blender.html">blender  </a><a href="http://www.elfnor.com/tag/sverchok.html">sverchok  </a></p></a>      			      </li>
		
	
			      <li>
<a href="http://www.elfnor.com/hyperbolic-tiling-in-3d.html" rel="bookmark" title="Permalink to Hyperbolic Tiling in 3D">Hyperbolic Tiling in 3D</a>
  <time datetime="2015-11-06T22:00:00+13:00" pubdate>Fri 06 November 2015</time>
<p class="tags">tags: <a href="http://www.elfnor.com/tag/make.html">make  </a><a href="http://www.elfnor.com/tag/think.html">think  </a><a href="http://www.elfnor.com/tag/blender.html">blender  </a><a href="http://www.elfnor.com/tag/sverchok.html">sverchok  </a></p></a>      			      </li>
		
	
			      <li>
<a href="http://www.elfnor.com/shaders-for-sverchok-04-vertex-colors-update.html" rel="bookmark" title="Permalink to Shaders for Sverchok 04 - Vertex Colors Update">Shaders for Sverchok 04 - Vertex Colors Update</a>
  <time datetime="2015-10-02T22:00:00+13:00" pubdate>Fri 02 October 2015</time>
<p class="tags">tags: <a href="http://www.elfnor.com/tag/make.html">make  </a><a href="http://www.elfnor.com/tag/think.html">think  </a><a href="http://www.elfnor.com/tag/blender.html">blender  </a><a href="http://www.elfnor.com/tag/sverchok.html">sverchok  </a></p></a>      			      </li>
		
	
			      <li>
<a href="http://www.elfnor.com/blender-linked-stars.html" rel="bookmark" title="Permalink to Blender Linked Stars">Blender Linked Stars</a>
  <time datetime="2015-09-27T22:00:00+13:00" pubdate>Sun 27 September 2015</time>
<p class="tags">tags: <a href="http://www.elfnor.com/tag/make.html">make  </a><a href="http://www.elfnor.com/tag/think.html">think  </a><a href="http://www.elfnor.com/tag/blender.html">blender  </a></p></a>      			      </li>
		
		
		
		
		
		
		
		
		
		
		
		
		
		
		
		
		
		
		
		
		
		
		
		
		
		
		
		
		
		
		
		
		
		
		
		
		
		
		
		
		
		
		
		
		
	
                        </u1>
		
		</nav>

	          <h2>Categories</h2>
	          <ul class = "social">
		      <li> <a href="http://www.elfnor.com/archives.html">everything </a></li>	
	              <li ><a href="http://www.elfnor.com/category/look.html">look</a></li>
	              <li ><a href="http://www.elfnor.com/category/make.html">make</a></li>
	              <li class="active"><a href="http://www.elfnor.com/category/think.html">think</a></li>
	          </ul>
	        

	          <aside>
	          <h2>Elsewhere</h2>
			    <ul class="social">
				  <li><a href="http://elfnor.deviantart.com">on deviant art</a><i></i></li>
				  <li><a href="http://www.thingiverse.com/elfnor">on thingiverse</a><i></i></li>
				  <li><a href="https://github.com/elfnor">on github</a><i></i></li>
			    </ul>
			  </aside>
                
                <h2>Tags</h2>
	
                        <ul class="tagcloud">
                            <li class="tag-2"><a href="http://www.elfnor.com/tag/reading.html">reading</a></li>
                            <li class="tag-4"><a href="http://www.elfnor.com/tag/nonsense.html">nonsense</a></li>
                            <li class="tag-1"><a href="http://www.elfnor.com/tag/think.html">think</a></li>
                            <li class="tag-3"><a href="http://www.elfnor.com/tag/markdown.html">markdown</a></li>
                            <li class="tag-3"><a href="http://www.elfnor.com/tag/geocaching.html">geocaching</a></li>
                            <li class="tag-3"><a href="http://www.elfnor.com/tag/python.html">python</a></li>
                            <li class="tag-2"><a href="http://www.elfnor.com/tag/symmetrytile.html">symmetrytile</a></li>
                            <li class="tag-3"><a href="http://www.elfnor.com/tag/materials.html">materials</a></li>
                            <li class="tag-3"><a href="http://www.elfnor.com/tag/cats.html">cats</a></li>
                            <li class="tag-3"><a href="http://www.elfnor.com/tag/micropython.html">micropython</a></li>
                            <li class="tag-2"><a href="http://www.elfnor.com/tag/structuresynth.html">structuresynth</a></li>
                            <li class="tag-4"><a href="http://www.elfnor.com/tag/kites.html">kites</a></li>
                            <li class="tag-4"><a href="http://www.elfnor.com/tag/webalbum.html">webalbum</a></li>
                            <li class="tag-3"><a href="http://www.elfnor.com/tag/3d-printing.html">3D Printing</a></li>
                            <li class="tag-4"><a href="http://www.elfnor.com/tag/maze.html">maze</a></li>
                            <li class="tag-4"><a href="http://www.elfnor.com/tag/processing.html">processing</a></li>
                            <li class="tag-1"><a href="http://www.elfnor.com/tag/blender.html">blender</a></li>
                            <li class="tag-1"><a href="http://www.elfnor.com/tag/sverchok.html">sverchok</a></li>
                            <li class="tag-3"><a href="http://www.elfnor.com/tag/copy2.html">copy2</a></li>
                            <li class="tag-3"><a href="http://www.elfnor.com/tag/ebook.html">ebook</a></li>
                            <li class="tag-1"><a href="http://www.elfnor.com/tag/make.html">make</a></li>
                            <li class="tag-3"><a href="http://www.elfnor.com/tag/pelican.html">pelican</a></li>
                        </ul>
                      
		
		  </div>

	  </div>

      <footer>
		<p role="contentinfo">
		  © 2013 elfnor - Proudly powered by <a href="http://alexis.notmyidea.org/pelican/">pelican</a>. Theme <a href="https://github.com/fle/pelican-simplegrey"> pelican-simplegrey</a>, modified.
    	</p>

	  </footer>	

	</div>
<!-- Start of StatCounter Code for Default Guide -->
<script type="text/javascript">
var sc_project=9900594; 
var sc_invisible=1; 
var sc_security="efb2c43c"; 
var scJsHost = (("https:" == document.location.protocol) ?
"https://secure." : "http://www.");
document.write("<sc"+"ript type='text/javascript' src='" +
scJsHost+
"statcounter.com/counter/counter.js'></"+"script>");
</script>
<noscript><div class="statcounter"><a title="free hit
counter" href="http://statcounter.com/" target="_blank"><img
class="statcounter"
src="http://c.statcounter.com/9900594/0/efb2c43c/1/"
alt="free hit counter"></a></div></noscript>
<!-- End of StatCounter Code for Default Guide -->
</body>
</html>