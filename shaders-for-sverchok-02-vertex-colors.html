<!doctype html>
<html lang="">	
<head>
	<meta charset="utf-8"/>
	<title>Shaders for Sverchok 02 - Vertex Colors - Look Think Make</title>	
	<meta name="author" content="elfnor">
	

	<meta name="description" content="This is the second of my Shaders for Sverchok tutorials. They follow on from my Simple Sverchok series. The Shaders for Sverchok posts are mostly about Blender Cycles Materials and how I apply them to my Sverchok models rather than directly about Sverchok nodes. This post will show how to ...">


	<link rel="top" href="#" /><link href='http://fonts.googleapis.com/css?family=Source+Sans+Pro:300,400,600,300italic,400italic,600italic|Source+Code+Pro' rel='stylesheet' type='text/css'></link>
	<link href='http://fonts.googleapis.com/css?family=Bitter' rel='stylesheet' type='text/css'>
<link href='http://fonts.googleapis.com/css?family=Rock+Salt' rel='stylesheet' type='text/css'>
	<link rel="stylesheet" href="http://www.elfnor.com/theme/css/main.css" type="text/css" />
		

    <link href="http://www.elfnor.com/feeds/all.atom.xml" type="application/atom+xml" rel="alternate" title="Look Think Make Atom Feed" />
</head>
	
<body>

    <div class="container">
	  
	  <header role="banner">
	    <div class="feeds">
	        <a href="http://www.elfnor.com/feeds/all.atom.xml" rel="alternate"><img src="/theme/images/icons/feed-32px.png" alt="atom feed"/></a>
	    </div>
	      <nav class="pages">
			  <a href="http://www.elfnor.com/pages/about-me.html">About Me</a>
-			  <a href="http://www.elfnor.com/pages/galleries.html">Galleries</a>
	      </nav>
		<a href="http://www.elfnor.com" class="title">Look Think Make</a>
      </header>
	
	  <div class="wrapper">

		  <div role="main" class="content">
	<article class="full">
			
		<h1>Shaders for Sverchok 02 - Vertex Colors</h1>
		
<div class="metadata">
  <time datetime="2015-02-26T22:00:00+13:00" pubdate>Thu 26 February 2015</time>
    <address class="vcard author">
      by <a class="url fn" href="http://www.elfnor.com/author/elfnor.html">elfnor</a>
    </address>
  in <a href="http://www.elfnor.com/category/think.html">think</a>
<p class="tags">tagged <a href="http://www.elfnor.com/tag/make.html">make</a>, <a href="http://www.elfnor.com/tag/think.html">think</a>, <a href="http://www.elfnor.com/tag/blender.html">blender</a>, <a href="http://www.elfnor.com/tag/sverchok.html">sverchok</a></p></div>		
		<p><img alt="nested cubes demo of sverchok vertex colors" src="/images/vertex_color_blog_21.png" /></p>
<p>This is the second of my Shaders for Sverchok tutorials. They follow on from  my <a href="http://elfnor.com/tag/sverchok.html">Simple Sverchok</a> series. The Shaders for Sverchok posts are mostly about Blender Cycles Materials and how I apply them to my <a href="http://nikitron.cc.ua/sverchok_en.html">Sverchok</a> models rather than directly about Sverchok nodes.</p>
<p>This post will show how to apply vertex colors to a mesh with Blender python and then how to access the vertex color map to apply color or other variation to a material in Blender cycles.</p>
<p>From this <a href="http://blenderartists.org/forum/showthread.php?272679-Addon-WIP-Sverchok-parametric-nodes-for-architects&amp;p=2813513&amp;viewfull=1#post2813513">sneak preview</a> it looks like Vertex Colors may be avaliable soon as Sverchok node, but currently I use a short bit of code to cover this step. I'll update this post when the node becomes available in a general release.</p>
<p>Using vertex colors is easiest if the Sverchok output is a single mesh. If after baking your Sverchok output you have multiple meshes try the "Apply matrix to mesh" node or occasionally the "Mesh Join" node to consolidate everything into one mesh. It is also possible to select the objects after creation and join them with CTRL-J. I prefer using the "Apply Matrix" node as this preserves the creation order of the mesh elements. </p>
<p>Vertex colors are normally applied by painting them on in "Vertex Paint" mode. To get them to show as painted in Blender cycles use a material as shown below. The "Attribute" node is found on the "Input" panel of the cycles nodes. The "Name" has to be set to the same as the name of the "Vertex Colors" layer found under the Objects Data panel.</p>
<p><img alt="vertex color in blender" src="/images/vertex_colors_screen.png" /></p>
<p>Rather than paint on our colors we're going to assign them to the vertices using Blender python. Each vertex in each face has its own vertex color. This means a vertex can have several different colors, one for each face it's on. The following code snippet gives a different vertex color for each sub-element of a mesh. Say for instance we've used a "Matrix Iterate" node to make 11 copies of a Box (10 iterations produces 11 copies). Then the code snippet will make all the vertices in each box the same color but each box will have a different color.</p>
<p><img alt="nested boxes nodes" src="/images/nested_box_nodes.png" /></p>
<div class="highlight"><pre><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">set vertex color to shades of grey, each cube in sverchok structure has its own shade</span>
<span class="sd">&quot;&quot;&quot;</span>
<span class="kn">import</span> <span class="nn">bpy</span>
<span class="kn">import</span> <span class="nn">random</span>

<span class="c"># start in object mode with object selected</span>
<span class="c">#need to set N to the number of sub-elements in mesh</span>
<span class="n">N</span> <span class="o">=</span> <span class="mi">11</span> <span class="c"># no of elements</span>

<span class="n">obj</span> <span class="o">=</span> <span class="n">bpy</span><span class="o">.</span><span class="n">context</span><span class="o">.</span><span class="n">active_object</span>
<span class="n">mesh</span> <span class="o">=</span> <span class="n">obj</span><span class="o">.</span><span class="n">data</span>

<span class="k">if</span> <span class="ow">not</span> <span class="n">mesh</span><span class="o">.</span><span class="n">vertex_colors</span><span class="p">:</span>
    <span class="n">mesh</span><span class="o">.</span><span class="n">vertex_colors</span><span class="o">.</span><span class="n">new</span><span class="p">()</span>

<span class="n">color_layer</span> <span class="o">=</span> <span class="n">mesh</span><span class="o">.</span><span class="n">vertex_colors</span><span class="o">.</span><span class="n">active</span>

<span class="n">nvert</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">color_layer</span><span class="o">.</span><span class="n">data</span><span class="p">)</span><span class="o">/</span><span class="n">N</span>
<span class="n">inc</span> <span class="o">=</span> <span class="mf">1.0</span><span class="o">/</span><span class="n">N</span>
<span class="n">i</span> <span class="o">=</span> <span class="mi">0</span>
<span class="k">for</span> <span class="n">poly</span> <span class="ow">in</span> <span class="n">mesh</span><span class="o">.</span><span class="n">polygons</span><span class="p">:</span>
    <span class="k">for</span> <span class="n">idx</span> <span class="ow">in</span> <span class="n">poly</span><span class="o">.</span><span class="n">loop_indices</span><span class="p">:</span>
        <span class="n">rgb</span> <span class="o">=</span> <span class="p">[(</span><span class="n">i</span><span class="o">//</span><span class="n">nvert</span><span class="p">)</span><span class="o">*</span><span class="n">inc</span><span class="p">,</span> <span class="p">(</span><span class="n">i</span><span class="o">//</span><span class="n">nvert</span><span class="p">)</span><span class="o">*</span><span class="n">inc</span><span class="p">,</span> <span class="p">(</span><span class="n">i</span><span class="o">//</span><span class="n">nvert</span><span class="p">)</span><span class="o">*</span><span class="n">inc</span><span class="p">]</span>
        <span class="n">color_layer</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">color</span> <span class="o">=</span> <span class="n">rgb</span>
        <span class="n">i</span> <span class="o">+=</span> <span class="mi">1</span>
</pre></div>


<p>Before running the above code you need to set N in line 9 of the code to the number of sub-elements in the mesh. The code sets each sub-element to a shade of grey. You can fiddle with the code to produce different vertex colors, but I prefer to manipulate the color later with cycles nodes as this give me more flexibility.</p>
<p>After running the code check in the Objects data panel to find the name of the vertex color layer. By default its "Col". Use this in a attribute node to access the values for the vertex color. This color can then be separated out into rgb components and used to vary the material properties across the sub-elements in the mesh. In the node diagram below it's used to control the "fac" of a "Mix Shader" to mix between two materials.</p>
<h2><img alt="vertex color node mix" src="/images/nested_box_cycles_nodes.png" /></h2>	

	</article>

	<div class="comments">
	<h2>Comments !</h2>
	    <div id="disqus_thread"></div>
	    <script type="text/javascript">
	       var disqus_identifier = "shaders-for-sverchok-02-vertex-colors.html";
	       (function() {
	       var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
	       dsq.src = 'http://lookthinkmake.disqus.com/embed.js';
	       (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
	      })();
	    </script>
	</div>

		  </div>	
		  
		  <div class="sidebar">

	        <nav>
		  <h2>Recent Posts</h2>
			<ul class="archive">
	
			      <li>
<a href="http://www.elfnor.com/blender-3d-maze-generator.html" rel="bookmark" title="Permalink to Blender 3D Maze Generator">Blender 3D Maze Generator</a>
  <time datetime="2015-12-20T22:00:00+13:00" pubdate>Sun 20 December 2015</time>
<p class="tags">tags: <a href="http://www.elfnor.com/tag/make.html">make  </a><a href="http://www.elfnor.com/tag/think.html">think  </a><a href="http://www.elfnor.com/tag/blender.html">blender  </a><a href="http://www.elfnor.com/tag/sverchok.html">sverchok  </a><a href="http://www.elfnor.com/tag/maze.html">maze  </a></p></a>      			      </li>
		
	
			      <li>
<a href="http://www.elfnor.com/blender-2d-maze-generator.html" rel="bookmark" title="Permalink to Blender 2D Maze Generator">Blender 2D Maze Generator</a>
  <time datetime="2015-12-11T22:00:00+13:00" pubdate>Fri 11 December 2015</time>
<p class="tags">tags: <a href="http://www.elfnor.com/tag/make.html">make  </a><a href="http://www.elfnor.com/tag/think.html">think  </a><a href="http://www.elfnor.com/tag/blender.html">blender  </a><a href="http://www.elfnor.com/tag/sverchok.html">sverchok  </a><a href="http://www.elfnor.com/tag/maze.html">maze  </a></p></a>      			      </li>
		
	
			      <li>
<a href="http://www.elfnor.com/larger-hyperbolic-tilings-in-3d-using-processing.html" rel="bookmark" title="Permalink to Larger Hyperbolic Tilings in 3D using Processing">Larger Hyperbolic Tilings in 3D using Processing</a>
  <time datetime="2015-11-27T22:00:00+13:00" pubdate>Fri 27 November 2015</time>
<p class="tags">tags: <a href="http://www.elfnor.com/tag/make.html">make  </a><a href="http://www.elfnor.com/tag/think.html">think  </a><a href="http://www.elfnor.com/tag/blender.html">blender  </a><a href="http://www.elfnor.com/tag/processing.html">processing  </a></p></a>      			      </li>
		
	
			      <li>
<a href="http://www.elfnor.com/symmetry-tile-painting-in-blender.html" rel="bookmark" title="Permalink to Symmetry Tile Painting in Blender">Symmetry Tile Painting in Blender</a>
  <time datetime="2015-11-21T22:00:00+13:00" pubdate>Sat 21 November 2015</time>
<p class="tags">tags: <a href="http://www.elfnor.com/tag/make.html">make  </a><a href="http://www.elfnor.com/tag/think.html">think  </a><a href="http://www.elfnor.com/tag/blender.html">blender  </a><a href="http://www.elfnor.com/tag/symmetrytile.html">symmetrytile  </a></p></a>      			      </li>
		
	
			      <li>
<a href="http://www.elfnor.com/painting-in-the-hyperbolic-plane.html" rel="bookmark" title="Permalink to Painting in the Hyperbolic Plane">Painting in the Hyperbolic Plane</a>
  <time datetime="2015-11-14T22:00:00+13:00" pubdate>Sat 14 November 2015</time>
<p class="tags">tags: <a href="http://www.elfnor.com/tag/make.html">make  </a><a href="http://www.elfnor.com/tag/think.html">think  </a><a href="http://www.elfnor.com/tag/blender.html">blender  </a><a href="http://www.elfnor.com/tag/sverchok.html">sverchok  </a></p></a>      			      </li>
		
	
			      <li>
<a href="http://www.elfnor.com/hyperbolic-tiling-in-3d.html" rel="bookmark" title="Permalink to Hyperbolic Tiling in 3D">Hyperbolic Tiling in 3D</a>
  <time datetime="2015-11-06T22:00:00+13:00" pubdate>Fri 06 November 2015</time>
<p class="tags">tags: <a href="http://www.elfnor.com/tag/make.html">make  </a><a href="http://www.elfnor.com/tag/think.html">think  </a><a href="http://www.elfnor.com/tag/blender.html">blender  </a><a href="http://www.elfnor.com/tag/sverchok.html">sverchok  </a></p></a>      			      </li>
		
	
			      <li>
<a href="http://www.elfnor.com/shaders-for-sverchok-04-vertex-colors-update.html" rel="bookmark" title="Permalink to Shaders for Sverchok 04 - Vertex Colors Update">Shaders for Sverchok 04 - Vertex Colors Update</a>
  <time datetime="2015-10-02T22:00:00+13:00" pubdate>Fri 02 October 2015</time>
<p class="tags">tags: <a href="http://www.elfnor.com/tag/make.html">make  </a><a href="http://www.elfnor.com/tag/think.html">think  </a><a href="http://www.elfnor.com/tag/blender.html">blender  </a><a href="http://www.elfnor.com/tag/sverchok.html">sverchok  </a></p></a>      			      </li>
		
		
		
		
		
		
		
		
		
		
		
		
		
		
		
		
		
		
		
		
		
		
		
		
		
		
		
		
		
		
		
		
		
		
		
		
		
		
		
		
		
		
		
		
		
		
	
                        </u1>
		
		</nav>

	          <h2>Categories</h2>
	          <ul class = "social">
		      <li> <a href="http://www.elfnor.com/archives.html">everything </a></li>	
	              <li ><a href="http://www.elfnor.com/category/look.html">look</a></li>
	              <li ><a href="http://www.elfnor.com/category/make.html">make</a></li>
	              <li class="active"><a href="http://www.elfnor.com/category/think.html">think</a></li>
	          </ul>
	        

	          <aside>
	          <h2>Elsewhere</h2>
			    <ul class="social">
				  <li><a href="http://elfnor.deviantart.com">on deviant art</a><i></i></li>
				  <li><a href="http://www.thingiverse.com/elfnor">on thingiverse</a><i></i></li>
				  <li><a href="https://github.com/elfnor">on github</a><i></i></li>
			    </ul>
			  </aside>
                
                <h2>Tags</h2>
	
                        <ul class="tagcloud">
                            <li class="tag-4"><a href="http://www.elfnor.com/tag/kites.html">kites</a></li>
                            <li class="tag-1"><a href="http://www.elfnor.com/tag/think.html">think</a></li>
                            <li class="tag-3"><a href="http://www.elfnor.com/tag/ebook.html">ebook</a></li>
                            <li class="tag-3"><a href="http://www.elfnor.com/tag/materials.html">materials</a></li>
                            <li class="tag-2"><a href="http://www.elfnor.com/tag/reading.html">reading</a></li>
                            <li class="tag-3"><a href="http://www.elfnor.com/tag/copy2.html">copy2</a></li>
                            <li class="tag-4"><a href="http://www.elfnor.com/tag/webalbum.html">webalbum</a></li>
                            <li class="tag-3"><a href="http://www.elfnor.com/tag/3d-printing.html">3D Printing</a></li>
                            <li class="tag-2"><a href="http://www.elfnor.com/tag/structuresynth.html">structuresynth</a></li>
                            <li class="tag-1"><a href="http://www.elfnor.com/tag/make.html">make</a></li>
                            <li class="tag-3"><a href="http://www.elfnor.com/tag/geocaching.html">geocaching</a></li>
                            <li class="tag-3"><a href="http://www.elfnor.com/tag/micropython.html">micropython</a></li>
                            <li class="tag-3"><a href="http://www.elfnor.com/tag/python.html">python</a></li>
                            <li class="tag-4"><a href="http://www.elfnor.com/tag/processing.html">processing</a></li>
                            <li class="tag-1"><a href="http://www.elfnor.com/tag/sverchok.html">sverchok</a></li>
                            <li class="tag-1"><a href="http://www.elfnor.com/tag/blender.html">blender</a></li>
                            <li class="tag-2"><a href="http://www.elfnor.com/tag/symmetrytile.html">symmetrytile</a></li>
                            <li class="tag-3"><a href="http://www.elfnor.com/tag/cats.html">cats</a></li>
                            <li class="tag-3"><a href="http://www.elfnor.com/tag/pelican.html">pelican</a></li>
                            <li class="tag-3"><a href="http://www.elfnor.com/tag/maze.html">maze</a></li>
                            <li class="tag-3"><a href="http://www.elfnor.com/tag/markdown.html">markdown</a></li>
                            <li class="tag-4"><a href="http://www.elfnor.com/tag/nonsense.html">nonsense</a></li>
                        </ul>
                      
		
		  </div>

	  </div>

      <footer>
		<p role="contentinfo">
		  © 2013 elfnor - Proudly powered by <a href="http://alexis.notmyidea.org/pelican/">pelican</a>. Theme <a href="https://github.com/fle/pelican-simplegrey"> pelican-simplegrey</a>, modified.
    	</p>

	  </footer>	

	</div>
<!-- Start of StatCounter Code for Default Guide -->
<script type="text/javascript">
var sc_project=9900594; 
var sc_invisible=1; 
var sc_security="efb2c43c"; 
var scJsHost = (("https:" == document.location.protocol) ?
"https://secure." : "http://www.");
document.write("<sc"+"ript type='text/javascript' src='" +
scJsHost+
"statcounter.com/counter/counter.js'></"+"script>");
</script>
<noscript><div class="statcounter"><a title="free hit
counter" href="http://statcounter.com/" target="_blank"><img
class="statcounter"
src="http://c.statcounter.com/9900594/0/efb2c43c/1/"
alt="free hit counter"></a></div></noscript>
<!-- End of StatCounter Code for Default Guide -->
</body>
</html>