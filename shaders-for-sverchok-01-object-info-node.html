<!doctype html>
<html lang="">	
<head>
	<meta charset="utf-8"/>
	<title>Shaders for Sverchok 01 - Object Info node. - Look Think Make</title>	
	<meta name="author" content="elfnor">
	

	<meta name="description" content="I've called this post Shaders for Sverchok and it follows on from my Simple Sverchok series. It's mostly about Blender Cycles Materials and how I apply them to my Sverchok models rather than directly about Sverchok nodes. The structures I've been producing with Sverchok can have many ...">


	<link rel="top" href="#" /><link href='http://fonts.googleapis.com/css?family=Source+Sans+Pro:300,400,600,300italic,400italic,600italic|Source+Code+Pro' rel='stylesheet' type='text/css'></link>
	<link href='http://fonts.googleapis.com/css?family=Bitter' rel='stylesheet' type='text/css'>
<link href='http://fonts.googleapis.com/css?family=Rock+Salt' rel='stylesheet' type='text/css'>
	<link rel="stylesheet" href="http://www.elfnor.com/theme/css/main.css" type="text/css" />
		

    <link href="http://www.elfnor.com/feeds/all.atom.xml" type="application/atom+xml" rel="alternate" title="Look Think Make Atom Feed" />
</head>
	
<body>

    <div class="container">
	  
	  <header role="banner">
	    <div class="feeds">
	        <a href="http://www.elfnor.com/feeds/all.atom.xml" rel="alternate"><img src="/theme/images/icons/feed-32px.png" alt="atom feed"/></a>
	    </div>
	      <nav class="pages">
			  <a href="http://www.elfnor.com/pages/about-me.html">About Me</a>
-			  <a href="http://www.elfnor.com/pages/galleries.html">Galleries</a>
	      </nav>
		<a href="http://www.elfnor.com" class="title">Look Think Make</a>
      </header>
	
	  <div class="wrapper">

		  <div role="main" class="content">
	<article class="full">
			
		<h1>Shaders for Sverchok 01 - Object Info node.</h1>
		
<div class="metadata">
  <time datetime="2015-02-22T22:00:00" pubdate>Sun 22 February 2015</time>
    <address class="vcard author">
      by <a class="url fn" href="http://www.elfnor.com/author/elfnor.html">elfnor</a>
    </address>
  in <a href="http://www.elfnor.com/category/think.html">think</a>
<p class="tags">tagged <a href="http://www.elfnor.com/tag/make.html">make</a>, <a href="http://www.elfnor.com/tag/think.html">think</a>, <a href="http://www.elfnor.com/tag/blender.html">blender</a>, <a href="http://www.elfnor.com/tag/sverchok.html">sverchok</a></p></div>		
		<p><img alt="hydrangea abstract" src="/images/abstract_21.png" /></p>
<p>I've called this post Shaders for Sverchok and it follows on from  my <a href="http://elfnor.com/tag/sverchok.html">Simple Sverchok</a> series. It's mostly about Blender Cycles Materials and how I apply them to my <a href="http://nikitron.cc.ua/sverchok_en.html">Sverchok</a> models rather than directly about Sverchok nodes.</p>
<p>The structures I've been producing with Sverchok can have many elements. The one that featured in the title image for the <a href="http://www.elfnor.com/simple-sverchok-05-interpolate-and-iterate-matrix.html">last post</a> has 2400 copies of the box element. With the position, rotation and scale of each object being varied parametrically it would be neat to also systematically vary the colour or transparency of the elements. Applying individual materials to 2400 elements by hand is well beyond my pain threshold. The techniques used here to make systematic or random material variations can also be used for models with many elements produced in other ways, for example using dupliverts.</p>
<h1>Object Info Node</h1>
<p>Change the Node Editor window to show Shaders (materials). Make sure Cycles is chosen as the render engine. Start with an "Object Info" node ("Add &gt; Input &gt; Object Info"). This gives information  about the object or objects a Material is applied to. If the elements you want to shade are combined into a single mesh they will need to be separated. In edit mode a mesh can be separated into objects by hitting "P" and selecting "By loose parts".  It's a good idea to apply a material to the mesh before separating parts. This way all parts will have the same material which can be edited later. It is also possible to separate loose parts using the "Separate Loose Parts" node. </p>
<p>Tip: In Blender if you need to apply the same material to lots of different objects, join them together, apply the material and then separate by parts again.</p>
<h2>Location based Shading</h2>
<p>The first output of the "Object Info" node is location. This gives the (x, y, z) coordinates of the object the material is applied to. Unfortunately the Shader nodes do not have the wonderfully useful "Viewer text" and "Stethoscope" nodes that Sverchok does. Without these we're running a bit blind and have to read the documentation a bit more and do lots of small bits of math.</p>
<p>If the elements you want to shade were separated from a single mesh they may all have the same location. To fix this, select all the objects and "Object &gt; Transform &gt; Origin to Geometry". This will give each object its own location at the centre of its own mesh.</p>
<p>The location of the object can be sent directly to the color input of any shader node. However the shader node expects the RGB values to be between 0 and 1. One easy way to do this is rescale your scene so that all the geometry lies in a box between (0, 0, 0) and (1, 1, 1). The colour of objects in this space will shade from black at the (0, 0, 0) corner to white at the far (1, 1, 1) corner. Objects in the (1, 0, 0) corner will be red and so on. In the following scene all objects have the same material. The wireframe cube extends from (0, 0, 0) to (1, 1, 1). It is a neutral grey colour because its location is (0.5, 0.5, 0.5). </p>
<p><img alt="spiral in color cube" src="/images/spirals_in_color_cube_01.png" /></p>
<p>Rather than scaling the geometry to lie within the (0,0,0) to (1,0,0) box we can scale the x, y, z coordinates within our node diagram.</p>
<p>In the following scene the spheres (dupliverted onto a torus) have locations from -1.25 to +1.25 in x and y and from -0.25 to +0.25 in z. We can use the Vector mapping node to transform these location values to the interval (0, 1).</p>
<div class="highlight"><pre><span class="n">r</span> <span class="o">=</span> <span class="mf">0.4</span> <span class="o">*</span> <span class="n">x</span> <span class="o">+</span> <span class="mf">0.5</span>
<span class="n">g</span> <span class="o">=</span> <span class="mf">0.4</span> <span class="o">*</span> <span class="n">x</span> <span class="o">+</span> <span class="mf">0.5</span>
<span class="n">b</span> <span class="o">=</span> <span class="mf">2.0</span> <span class="o">*</span> <span class="n">x</span> <span class="o">+</span> <span class="mf">0.5</span>
</pre></div>


<p>Strange things happen when the rgb values are not within the range (0, 1). The top torus has no scaling bewteen the location and color while the torus on the bottom has the rgb values between (0, 1).</p>
<p>EDIT: Jerryno's answer to my <a href="http://blender.stackexchange.com/questions/26254/how-and-when-does-clipping-of-rgb-values-happen">question</a> on stack exchange explains these strange things very well. </p>
<p><img alt="torus location to rgb" src="/images/torus_color.png" /></p>
<p>We can also use the location as an index into a "Color Ramp" node. This requires reducing the three x, y, z coordinates to a single value between (0, 1). </p>
<p>For instance we can shade our torus radially by calculating:</p>
<div class="highlight"><pre><span class="n">radius</span> <span class="o">=</span> <span class="n">sqrt</span><span class="p">(</span><span class="n">x</span><span class="o">^</span><span class="mi">2</span> <span class="o">+</span><span class="n">y</span><span class="o">^</span><span class="mi">2</span> <span class="o">+</span> <span class="n">z</span><span class="o">^</span><span class="mi">2</span><span class="p">)</span> <span class="n">to</span> <span class="n">give</span> <span class="n">radius</span> <span class="n">between</span> <span class="p">(</span><span class="mf">0.75</span> <span class="n">and</span> <span class="mf">1.25</span><span class="p">)</span>

<span class="n">fac</span> <span class="o">=</span> <span class="mi">2</span><span class="o">*</span><span class="n">radius</span> <span class="o">-</span> <span class="mf">1.5</span> <span class="n">to</span> <span class="n">give</span> <span class="n">fac</span> <span class="n">between</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
</pre></div>


<p>These calculations can be done a number of ways. Here I have used the "Normalize" node to give the radius and two "Math" nodes to do the scaling.</p>
<p><img alt="torus radial color" src="/images/torus_radial.png" /></p>
<h2>Object Pass Index</h2>
<p>The second output of the "Object Info" node is labeled "Object Index". This is the same parameter that is called "Pass Index" on the Object Relations Panel. It can be set in the Objects Relations panel or in python using</p>
<div class="highlight"><pre><span class="cp">#set each of the selected objects to a separate pass index</span>
<span class="n">import</span> <span class="n">bpy</span>
<span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">obj</span> <span class="n">in</span> <span class="n">enumerate</span><span class="p">(</span><span class="n">bpy</span><span class="p">.</span><span class="n">context</span><span class="p">.</span><span class="n">selected_objects</span><span class="p">)</span><span class="o">:</span>
     <span class="n">obj</span><span class="p">.</span><span class="n">pass_index</span> <span class="o">=</span> <span class="n">i</span>
</pre></div>


<p>Again for input to most material nodes the pass index value will need to be scaled so it is in the interval (0, 1).</p>
<h2>Material Pass Index</h2>
<p>The third output of the "Object Info" node is labeled "Material Index". This output name is a little confusing as Blender has two different pass indexes (object and material) and two different material indexes (the pass index of the material and the material index of a face). Below I give an example of how to use it.  It's not that useful for scenes with a large number of objects as it requires a lot of manual steps but I've explained it here because I couldn't find a good example of using the material index of the Object info node anywhere else.</p>
<p>The "Material Index" output of the "Object Info" node is the same parameter that is called "Pass Index" on the Settings panel of a material. </p>
<h3>Example use of the "Material Index" of the "Object Info" node.</h3>
<p>This uses three materials but of course you can create as many materials as required.</p>
<ul>
<li>Start with the default cube scene and set the render engine to cycles.</li>
<li>Create a node material such as the "mat1" shown below that uses the "Material Index" output of the "Object Info" node.</li>
</ul>
<p><img alt="mat1 node setup" src="/images/material_index_blog-03.blend.png" /></p>
<ul>
<li>Select all the nodes except the "Object Info" and "Material Output" and group them</li>
<li>Use the "go to parent node tree" button at the bottom to collapse the node group. To edit it again click on the button at the top right of the node group</li>
<li>Select all three nodes showing and copy them to the clipboard (Ctrl-C)</li>
<li>Create a new material and call it "mat2"</li>
<li>Delete any nodes in the material and paste (Ctrl-V) our nodes to the material</li>
<li>Repeat the last two steps labeling the material "mat3"</li>
<li>You should now have 3 materials that all use the same node group. Check that there is a 3 in the number of users for the node group.</li>
</ul>
<p><img alt="mat1 as node group" src="/images/material_index_blog-04.blend.png" /></p>
<ul>
<li>Select an object and give it three material slots. Place the corresponding material in each slot.</li>
<li>For each material set the pass index to 1 , 2, or 3. (Under Materials - Settings panel).</li>
<li>As you do this the small icon beside the material slot should change color to match the color determined by the pass index</li>
<li>In edit mode select different faces of the object and assign a material from one of the slots.</li>
</ul>
<p><img alt="material index result" src="/images/material_index_blog-05.blend.png" /></p>
<h2>Random Shading</h2>
<p>The fourth output of the "Object Info" node is labeled  "Random". It produces a different random number between (0, 1) for each object the material is assigned to.</p>
<p>It can be used directly as input to a "Color Ramp" node or anywhere else a single value is required. </p>
<p><img alt="random color ramp" src="/images/color_random.png" /></p>
<hr />	

	</article>

	<div class="comments">
	<h2>Comments !</h2>
	    <div id="disqus_thread"></div>
	    <script type="text/javascript">
	       var disqus_identifier = "shaders-for-sverchok-01-object-info-node.html";
	       (function() {
	       var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
	       dsq.src = 'http://lookthinkmake.disqus.com/embed.js';
	       (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
	      })();
	    </script>
	</div>

		  </div>	
		  
		  <div class="sidebar">

	        <nav>
		  <h2>Recent Posts</h2>
			<ul class="archive">
	
			      <li>
<a href="http://www.elfnor.com/reading-the-world-100-online-stories.html" rel="bookmark" title="Permalink to Reading the World - 100 Online Stories">Reading the World - 100 Online Stories</a>
  <time datetime="2015-06-19T22:00:00" pubdate>Fri 19 June 2015</time>
<p class="tags">tags: <a href="http://www.elfnor.com/tag/reading.html">reading  </a></p></a>      			      </li>
		
	
			      <li>
<a href="http://www.elfnor.com/blender-game-level-generator.html" rel="bookmark" title="Permalink to Blender Game Level Generator">Blender Game Level Generator</a>
  <time datetime="2015-06-11T22:00:00" pubdate>Thu 11 June 2015</time>
<p class="tags">tags: <a href="http://www.elfnor.com/tag/make.html">make  </a><a href="http://www.elfnor.com/tag/think.html">think  </a><a href="http://www.elfnor.com/tag/blender.html">blender  </a><a href="http://www.elfnor.com/tag/sverchok.html">sverchok  </a><a href="http://www.elfnor.com/tag/structuresynth.html">structuresynth  </a></p></a>      			      </li>
		
	
			      <li>
<a href="http://www.elfnor.com/blender-progress-animations.html" rel="bookmark" title="Permalink to Blender Progress Animations">Blender Progress Animations</a>
  <time datetime="2015-06-01T22:00:00" pubdate>Mon 01 June 2015</time>
<p class="tags">tags: <a href="http://www.elfnor.com/tag/make.html">make  </a><a href="http://www.elfnor.com/tag/think.html">think  </a><a href="http://www.elfnor.com/tag/blender.html">blender  </a></p></a>      			      </li>
		
	
			      <li>
<a href="http://www.elfnor.com/blender-auto-save-add-on.html" rel="bookmark" title="Permalink to Blender Auto Save add-on">Blender Auto Save add-on</a>
  <time datetime="2015-05-29T22:00:00" pubdate>Fri 29 May 2015</time>
<p class="tags">tags: <a href="http://www.elfnor.com/tag/make.html">make  </a><a href="http://www.elfnor.com/tag/think.html">think  </a><a href="http://www.elfnor.com/tag/blender.html">blender  </a></p></a>      			      </li>
		
	
			      <li>
<a href="http://www.elfnor.com/blender-pipe-generator.html" rel="bookmark" title="Permalink to Blender Pipe Generator">Blender Pipe Generator</a>
  <time datetime="2015-05-24T22:00:00" pubdate>Sun 24 May 2015</time>
<p class="tags">tags: <a href="http://www.elfnor.com/tag/make.html">make  </a><a href="http://www.elfnor.com/tag/think.html">think  </a><a href="http://www.elfnor.com/tag/blender.html">blender  </a><a href="http://www.elfnor.com/tag/sverchok.html">sverchok  </a><a href="http://www.elfnor.com/tag/structuresynth.html">structuresynth  </a></p></a>      			      </li>
		
	
			      <li>
<a href="http://www.elfnor.com/a-git-horror-story.html" rel="bookmark" title="Permalink to A Git Horror Story">A Git Horror Story</a>
  <time datetime="2015-05-23T22:00:00" pubdate>Sat 23 May 2015</time>
<p class="tags">tags: <a href="http://www.elfnor.com/tag/think.html">think  </a><a href="http://www.elfnor.com/tag/nonsense.html">nonsense  </a></p></a>      			      </li>
		
	
			      <li>
<a href="http://www.elfnor.com/blender-ivy-gen-abstracts.html" rel="bookmark" title="Permalink to Blender Ivy Gen Abstracts">Blender Ivy Gen Abstracts</a>
  <time datetime="2015-05-17T22:00:00" pubdate>Sun 17 May 2015</time>
<p class="tags">tags: <a href="http://www.elfnor.com/tag/make.html">make  </a><a href="http://www.elfnor.com/tag/think.html">think  </a><a href="http://www.elfnor.com/tag/blender.html">blender  </a></p></a>      			      </li>
		
		
		
		
		
		
		
		
		
		
		
		
		
		
		
		
		
		
		
		
		
		
		
		
		
		
		
		
		
		
		
		
		
		
	
                        </u1>
		
		</nav>

	          <h2>Categories</h2>
	          <ul class = "social">
		      <li> <a href="http://www.elfnor.com/archives.html">everything </a></li>	
	              <li ><a href="http://www.elfnor.com/category/look.html">look</a></li>
	              <li ><a href="http://www.elfnor.com/category/make.html">make</a></li>
	              <li class="active"><a href="http://www.elfnor.com/category/think.html">think</a></li>
	          </ul>
	        

	          <aside>
	          <h2>Elsewhere</h2>
			    <ul class="social">
				  <li><a href="http://elfnor.deviantart.com">on deviant art</a><i></i></li>
				  <li><a href="http://www.thingiverse.com/elfnor">on thingiverse</a><i></i></li>
				  <li><a href="https://github.com/elfnor">on github</a><i></i></li>
			    </ul>
			  </aside>
                
                <h2>Tags</h2>
	
                        <ul class="tagcloud">
                            <li class="tag-3"><a href="http://www.elfnor.com/tag/ebook.html">ebook</a></li>
                            <li class="tag-1"><a href="http://www.elfnor.com/tag/sverchok.html">sverchok</a></li>
                            <li class="tag-4"><a href="http://www.elfnor.com/tag/.html"></a></li>
                            <li class="tag-2"><a href="http://www.elfnor.com/tag/structuresynth.html">structuresynth</a></li>
                            <li class="tag-4"><a href="http://www.elfnor.com/tag/webalbum.html">webalbum</a></li>
                            <li class="tag-3"><a href="http://www.elfnor.com/tag/geocaching.html">geocaching</a></li>
                            <li class="tag-3"><a href="http://www.elfnor.com/tag/cats.html">cats</a></li>
                            <li class="tag-3"><a href="http://www.elfnor.com/tag/materials.html">materials</a></li>
                            <li class="tag-4"><a href="http://www.elfnor.com/tag/kites.html">kites</a></li>
                            <li class="tag-3"><a href="http://www.elfnor.com/tag/3d-printing.html">3D Printing</a></li>
                            <li class="tag-3"><a href="http://www.elfnor.com/tag/copy2.html">copy2</a></li>
                            <li class="tag-3"><a href="http://www.elfnor.com/tag/reading.html">reading</a></li>
                            <li class="tag-3"><a href="http://www.elfnor.com/tag/pelican.html">pelican</a></li>
                            <li class="tag-3"><a href="http://www.elfnor.com/tag/markdown.html">markdown</a></li>
                            <li class="tag-4"><a href="http://www.elfnor.com/tag/nonsense.html">nonsense</a></li>
                            <li class="tag-1"><a href="http://www.elfnor.com/tag/make.html">make</a></li>
                            <li class="tag-2"><a href="http://www.elfnor.com/tag/symmetrytile.html">symmetrytile</a></li>
                            <li class="tag-1"><a href="http://www.elfnor.com/tag/think.html">think</a></li>
                            <li class="tag-1"><a href="http://www.elfnor.com/tag/blender.html">blender</a></li>
                        </ul>
                      
		
		  </div>

	  </div>

      <footer>
		<p role="contentinfo">
		  © 2013 elfnor - Proudly powered by <a href="http://alexis.notmyidea.org/pelican/">pelican</a>. Theme <a href="https://github.com/fle/pelican-simplegrey"> pelican-simplegrey</a>, modified.
    	</p>

	  </footer>	

	</div>
<!-- Start of StatCounter Code for Default Guide -->
<script type="text/javascript">
var sc_project=9900594; 
var sc_invisible=1; 
var sc_security="efb2c43c"; 
var scJsHost = (("https:" == document.location.protocol) ?
"https://secure." : "http://www.");
document.write("<sc"+"ript type='text/javascript' src='" +
scJsHost+
"statcounter.com/counter/counter.js'></"+"script>");
</script>
<noscript><div class="statcounter"><a title="free hit
counter" href="http://statcounter.com/" target="_blank"><img
class="statcounter"
src="http://c.statcounter.com/9900594/0/efb2c43c/1/"
alt="free hit counter"></a></div></noscript>
<!-- End of StatCounter Code for Default Guide -->
</body>
</html>